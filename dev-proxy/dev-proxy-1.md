# 개발 환경 프록시 서버 개발기

## 개발 배경

우리 개발팀에는 운영 중인 레포지토리가 적게 잡아도 50개는 된다.<br/>
프로덕트 별로 쪼개더라도 한 명의 개발자가 관여하는 레포지토리는 10개 안팎.<br/>

각 레포지토리의 서비스 환경에는 로컬, 테스트, 운영 세 종류가 있다. <br/>

프론트엔드 레포지토리 A 에 코드 작업을 해야 하는 상황이라고 가정해보자.<br/>
그 중에서도 작업 대상 페이지가 '로그인 필수' 지면인 경우다.<br/>

이 때 우리팀에서는 전통적으로 아래와 같은 레포지토리를 로컬에서 구동해야 했다.
- a. 작업 대상 프론트엔드 레포지토리 (A)
- b. 해당 지면에 필요한 api 를 서빙하는 백엔드 레포지토리 n개
- c. 인증을 담당하는 백엔드 레포지토리 

백엔드 서버 마이그레이션 등으로 b의 개수가 점차 많아지면서, 일부 팀원들은 <모든 레포 로컬 구동> 이라는 암묵적인 룰을 깨고, 불필요한 서버는 test 환경을 바라보도록 했다. <br/>
별다른 제약이 없는 듯 했으나, 문제는 인증에서 발생했다.<br/>
인증 토큰 발행 도메인은 로컬인데, 그 토큰을 테스트 서버에 들고가니 401 응답이 돌아왔던 것.<br/>

그렇다면 토큰 발행도 테스트 서버에서 해보면 어떨까.<br/>
우리 팀에서는 인증 토큰을 JWT 로 관리한다. <br/>
로그인 하고 받아온 토큰을 브라우저 쿠키에 써놔야 하는데, 테스트 인증 서버와 로컬 브라우저의 도메인이 달라 쿠키를 쓸 수가 없다. <br/>
프론트엔드에서 인증 요청을 가로채 직접 써주도록 땜빵을 해서 일단은 성공. <br/>
하지만 이 땜빵 코드를 모든 프론트엔드 레포에 작성할 수도 없는 노릇이었다.

레포지토리 몇개 더 띄우는게 그렇게 불편한가, 물을 수도 있지만, 내가 주목한 것은 당장 오늘의 개발 생산성 저하 뿐만 아니라, 개발 인력 확장의 한계였다. <br/>
당시 우리 팀에서는 단순 퍼블리싱 작업에 계약직을 적극 채용하고 있었다. <br/>
그런데 프론트엔드 하나만 작업할 분들께 백엔드 레포지토리 접근 권한, AWS SSM 접근 권한(백엔드 환경 변수를 SSM 으로 관리하고 있다), 심지어는 데이터베이스 접근 권한까지 드리고, 온보딩을 해드리고, 디버깅을 함께 해드려야 했다. <br/>

그래서 만든 것이 로컬 프록시 서버다.


/to be continued . . .

